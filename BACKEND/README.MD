# Retail Inventory Management - Authentication & Authorization

## ğŸ“Œ Overview

This section of the project implements Authentication & Authorization for a Retail Inventory Management System using Spring Boot, OAuth2, and JWT (JSON Web Tokens).

The system ensures:
- User Registration & Login
- JWT-based Authentication
- Role-based Access Control (RBAC)
- Token Validation & Security Measures

## ğŸ›  Technologies Used
- Spring Boot 3.x
- Spring Security
- OAuth2 & JWT
- RSA Public/Private Key Pair for Secure Token Signing
- Spring Data JPA (Hibernate)
- H2 (Development) / PostgreSQL (Production)
- Maven (Project Management & Dependencies)

## ğŸ“‚ Project Structure

```
src/main/java/com/retailinventory/
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ AuthController.java      # Handles user authentication
â”‚   â”œâ”€â”€ UserController.java      # Handles user profile retrieval
â”‚
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ JwtUtil.java             # JWT Token Generation & Validation
â”‚   â”œâ”€â”€ SecurityConfig.java      # Spring Security Configuration
â”‚
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ User.java                # User Entity Model
â”‚
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ UserRepository.java      # User Database Interactions
â”‚
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ AuthService.java         # Business Logic for Authentication
â”‚
â””â”€â”€ resources/
    â”œâ”€â”€ application.properties   # Spring Boot Configurations
    â”œâ”€â”€ private.pem              # RSA Private Key
    â”œâ”€â”€ public.pem               # RSA Public Key
```

## ğŸš€ Features Implemented

### âœ… 1. User Registration (POST /auth/register)
- Registers a new user with encrypted password (BCrypt).
- Role-based control (Admin, Employee).
- Stores user details in the database.

**Request Body**

```json
{
    "firstName": "John",
    "lastName": "Doe",
    "email": "johndoe@example.com",
    "password": "password123",
    "role": "ADMIN",
    "phoneNumber": "+1234567890"
}
```

**Expected Response**

```json
{
    "id": 1,
    "firstName": "John",
    "lastName": "Doe",
    "email": "johndoe@example.com",
    "role": "ADMIN",
    "phoneNumber": "+1234567890",
    "active": true,
    "createdAt": "2024-02-21T12:00:00",
    "updatedAt": "2024-02-21T12:00:00"
}
```

### âœ… 2. User Login (POST /auth/login)
- Authenticates user credentials.
- Generates a JWT token valid for 1 hour.

**Request Body**

```json
{
    "email": "johndoe@example.com",
    "password": "password123"
}
```

**Expected Response**

```json
{
    "message": "Login Successful",
    "token": "eyJhbGciOiJSUzI1NiIsInR..."
}
```

ğŸš€ Copy the token! You will need it for authentication in secured endpoints.

### âœ… 3. Validate Token (POST /auth/token/validate)
- Validates whether a given JWT token is valid or expired.

**Request Body**

```json
{
    "token": "YOUR_JWT_TOKEN_HERE"
}
```

**Expected Response**

```json
{
    "message": "Token is valid"
}
```

âŒ If the token is expired or invalid:

```json
{
    "message": "Invalid or expired token"
}
```

### âœ… 4. Get User Profile (GET /user/profile)
- Retrieves user profile information based on the JWT token.

**Headers (Authorization Required)**

```
Authorization: Bearer YOUR_JWT_TOKEN_HERE
```

**Expected Response**

```json
{
    "id": 1,
    "firstName": "John",
    "lastName": "Doe",
    "email": "johndoe@example.com",
    "role": "ADMIN",
    "phoneNumber": "+1234567890"
}
```

âŒ If no token is provided, you will get:

```json
{
    "error": "Unauthorized"
}
```

## ğŸ” Security Implementation

### 1ï¸âƒ£ JWT Token Generation
- Tokens are signed using RSA encryption (RS256).
- Public/Private key pair is used for security.

### 2ï¸âƒ£ RSA Key Pair Generation

To generate private & public keys, run:

```sh
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem
```

Move them to `src/main/resources/`:

```sh
mv private.pem src/main/resources/
mv public.pem src/main/resources/
```

### 3ï¸âƒ£ Token Structure

Decoded JWT structure:

```json
{
  "sub": "johndoe@example.com",
  "role": "ADMIN",
  "exp": 1740373834,
  "iat": 1740370234
}
```

Fields:
- `"sub"` â†’ User email
- `"role"` â†’ User role (Admin, Employee)
- `"exp"` â†’ Expiration timestamp
- `"iat"` â†’ Issued at timestamp

### 4ï¸âƒ£ Token Validation
- Uses Spring Security + Nimbus JWT Decoder.
- Checks token expiration before allowing access.

## ğŸ“Œ Testing with Postman

| Test Case                          | Endpoint                | Expected Outcome          |
|------------------------------------|-------------------------|---------------------------|
| âœ… Register User (Valid)           | POST /auth/register     | 201 Created               |
| âŒ Register User (Invalid Email)   | POST /auth/register     | 400 Bad Request           |
| âœ… Login (Valid Credentials)       | POST /auth/login        | 200 OK + Token            |
| âŒ Login (Wrong Password)          | POST /auth/login        | 401 Unauthorized          |
| âœ… Validate Token (Valid)          | POST /auth/token/validate | 200 OK                  |
| âŒ Validate Token (Invalid)        | POST /auth/token/validate | 401 Unauthorized        |
| âœ… Access Profile (With Token)     | GET /user/profile       | 200 OK                    |
| âŒ Access Profile (Without Token)  | GET /user/profile       | 403 Forbidden             |
