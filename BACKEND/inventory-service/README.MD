# ğŸª Inventory Management Service (`inventory-service`)

## ğŸš€ Overview
The `inventory-service` is responsible for **tracking and managing stock** of products in different stores. It ensures that:
- âœ… **Only `ADMIN` users can register and update stock.**
- âœ… **`EMPLOYEE` users can only view stock.**
- âœ… **No duplicate product entries exist for the same store.**
- âœ… **Stock updates when products are added or removed.**
- âœ… **JWT authentication is enforced to control access.**
- âœ… **Secure communication with `product-service` and `store-service` is established.**

---

## ğŸ”‘ **Role-Based Access Control (RBAC)**
The system has **two roles**:
1. **`ADMIN`** â€“ Has **full access** to manage inventory.
2. **`EMPLOYEE`** â€“ Can **only view** inventory.

### ğŸ›‚ **Access Permissions**
| **Role**  | **GET /inventory** | **POST /inventory** | **PUT /inventory** |
|-----------|------------------|------------------|------------------|
| **ADMIN** | âœ… Allowed | âœ… Allowed | âœ… Allowed |
| **EMPLOYEE** | âœ… Allowed | âŒ Forbidden | âŒ Forbidden |

---

## ğŸ”§ **How It Works**
### ğŸ›  **1. Secure Authentication with JWT**
- Users authenticate through **`auth-service`**, which generates a **JWT token**.
- The token contains **user role (`ADMIN` or `EMPLOYEE`)**.
- Example JWT payload:
        ```json
        {
                        "sub": "admin@example.com",
                        "role": "ADMIN",
                        "exp": 1740668714,
                        "iat": 1740665114
        }
        ```

### ğŸ” **2. Authorization in inventory-service**
- Spring Security reads the JWT and extracts the role claim.
- Role-based permissions are enforced in `SecurityConfig.java`:
        ```java
        .requestMatchers(HttpMethod.GET, "/inventory/**").hasAnyRole("ADMIN", "EMPLOYEE")
        .requestMatchers(HttpMethod.POST, "/inventory").hasRole("ADMIN")
        .requestMatchers(HttpMethod.PUT, "/inventory/**").hasRole("ADMIN")
        ```

---

## ğŸ“ **API Usage Guide**

### ğŸ“Œ **1. ADMIN Can Add Inventory**

**Request:**
```
POST /inventory
Authorization: Bearer ADMIN_JWT_TOKEN
Content-Type: application/json
```

**Request Body:**
```json
{
                "storeId": 1,
                "productId": 1,
                "quantity": 50
}
```

**Expected Response (201 Created):**
```json
{
                "id": 1,
                "storeId": 1,
                "productId": 1,
                "quantity": 50
}
```

### ğŸ“Œ **2. EMPLOYEE Tries to Add Inventory (Forbidden âŒ)**

**Headers:**
```
Authorization: Bearer EMPLOYEE_JWT_TOKEN
```

**Expected Response (403 Forbidden):**
```json
{
                "error": "Forbidden"
}
```

### ğŸ“Œ **3. Prevent Duplicate Product Entry in Same Store**

**Request:**
```
POST /inventory
Authorization: Bearer ADMIN_JWT_TOKEN
```

**Request Body:**
```json
{
                "storeId": 1,
                "productId": 1,
                "quantity": 30
}
```

**Expected Response (409 Conflict):**
```json
{
                "error": "Conflict",
                "message": "Product already exists in the inventory of this store"
}
```

### ğŸ“Œ **4. ADMIN Updates Stock**

**Request:**
```
PUT /inventory/1/1?quantity=75
Authorization: Bearer ADMIN_JWT_TOKEN
```

**Expected Response (200 OK):**
```json
{
                "id": 1,
                "storeId": 1,
                "productId": 1,
                "quantity": 75
}
```

### ğŸ“Œ **5. EMPLOYEE Retrieves Inventory**

**Request:**
```
GET /inventory/1
Authorization: Bearer EMPLOYEE_JWT_TOKEN
```

**Expected Response (200 OK):**
```json
[
                {
                                "id": 1,
                                "storeId": 1,
                                "productId": 1,
                                "quantity": 75
                }
]
```

### ğŸ“Œ **6. EMPLOYEE Tries to Update Stock (Forbidden âŒ)**

**Request:**
```
PUT /inventory/1/1?quantity=100
Authorization: Bearer EMPLOYEE_JWT_TOKEN
```

**Expected Response (403 Forbidden):**
```json
{
                "error": "Forbidden"
}
```

---

## ğŸš€ **Conclusion**
- âœ… JWT authentication ensures secure access.
- âœ… Spring Security enforces role-based access control (RBAC).
- âœ… Only `ADMIN` can add and update inventory.
- âœ… `EMPLOYEE` can only view inventory.
- âœ… No duplicate product entries per store.
- âœ… Stock updates correctly when products are added or removed.
